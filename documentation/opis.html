<?xml version='1.0' encoding='iso-8859-2'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
 <meta http-equiv="content-type" content="text/html; charset=iso-8859-2"/>
 <meta name="keywords" content="VI" />

<!-- default styles: -->
<link rel="stylesheet" type="text/css" href="/style/tp-base.css" title='ES'/>
<link rel="alternate stylesheet" type="text/css" href="/style/tp-bw.css" title='NS'/>
<link rel="alternate stylesheet" type="text/css" href="/style/tp-big.css" title='BS'/>
<script type="text/javascript" src="/script/sss.js" ></script>
<!-- styles end  -->

<title>Obs³uga www.flickr.com</title>
</head>
<body xml:lang="pl">

<!-- styl switch panel -->
<div class="styleswitchpanel">
   >>&#160;wybierz styl&#160;>>
   <a href="#" onclick="setActiveStyleSheet('ES'); return false;">es</a>
   ::&#160;<a href="#" onclick="setActiveStyleSheet('NS'); return false;">ns</a>
   ::&#160;<a href="#" onclick="setActiveStyleSheet('BS'); return false;">bs</a>
</div>
<!-- styl switch end -->

<h3 class='main'>Mój sposób na dodawanie zdjêæ na <code>flickr.com</code></h3>

<h3>Wprowadzenie</h3>

<p>
Flickr to jest fajna sprawa ale manualny sposób obs³ugi, tj. dodawanie
zdjêæ i opisów zabiera zbyt du¿o czasu (zw³aszcza jak siê ma ³±cze
512kb).  Istnieje oczywi¶cie API pozwalaj±ce robiæ to w sposób
programistyczny, tyle ¿e dalej pozostaje problem szybkiego dodawania
opisów.  Zapewne mój sposób nie jest optymalny ale lepszego nie znalaz³em.
</p>

<p>
Za³o¿enia s± takie: opis zdjêcia (tagi) maj± zawieraæ wspó³rzêdne
geograficzne oraz nazwy wa¿niejszych obiektów na zdjêciu (osoby,
budowle itp...)  Zdjêcia s± podzielone na zbiory (<em>set</em>), opis
ma te¿ zawieraæ informacjê do jakich zbiorów dodano
zdjêcie. <em>Reasumuj±c opis zdjêcia to: geotagi (wspó³rzêdne geograficzne
oraz nazwa miejsca), tagi (pozosta³e) i zbiory.</em>
</p>

<p>
Je¿eli chodzi o geotagi, to najpro¶ciej by³oby pobieraæ odpowiednie
warto¶ci z GPSa, tyle ¿e mój GPS nie dzia³a w wielu miejscach
co komplikuje sprawê synchronizacji w sposób opisany 
np. <a href="http://www.carto.net/projects/photoTools/gpsPhoto/">tutaj</a>.
Dlatego mój sposób na geotagowanie to
utrzymywanie bazy identyfikatorów typu <code>Sopot#Abrahama28</code>
czy <code>Gdañsk#Lotnisko</code> i pos³ugiwanie siê nimi podczas
opisywania zdjêæ.  Stosujê konwencjê dodawania do zdjêæ nastêpuj±cych
geotagów: <code>geo:longitude=d³ugo¶æ</code>,
<code>geo:latitude=szeroko¶æ</code> oraz <code>geo:loc=nazwa</code>
(nazwa, jest zawsze jednowyrazowa).  Dodatkowo dodajê warto¶ci
wspó³rzêdnych geograficznych do samego pliku (pola EXIF:
GPSLongitudeRef, GPSLatitudeRef, GPSLatitude, GPSLongitude oraz
GPSAreaInformation).
</p>

<p>
Dla pozosta³ych tagów stosujê konwencjê (od jakiego¶ czasu) wstawiania
pojêæ wielowyrazowych, a nie tworzenia jednowyrazowych dziwol±gów,
tj. <code>"tomasz przechlewski"</code> a nie <code>tomaszprzechlewski</code> 
czy <code>tomasz_przechlewski</code>. 
Aha, wszystkie tagi piszê ma³ymi literami.
</p>

<h3>Skrypty ,,konfiguracyjne''</h3>
<p>
Do dodawania zdjêæ na flickr wykorzystujê kilka 
nastêpuj±cych skryptów napisanych w Perlu:
</p>

<dl>
<dt><code>flickr_upld.pl</code> 
  oraz <code>flickr_xload.pl</code></dt>
<dd> skrypty ³aduj±ce obrazki na <code>www.flickr.com</code>
(opisane w nastêpnym <a href="#upld">punkcie</a>)
</dd>

<dt><code>flickr_getalltags.pl</code>
  oraz  <code>flickr_getsets.pl</code></dt>
<dd>skrypty pobieraj±ce z flickr.com i zapisuj±ce lokalnie informacje
   nt. wszystkich tagów oraz wszystkich zbiorów, 
   zdefiniowanych przez u¿ytkownika 
</dd>
</dl>

<p>
Dzia³anie skryptów
<code>flickr_getalltags.pl</code>/<code>flickr_getsets.pl</code> jest
bardzo proste, przyk³adowo uruchamiaj±c:
</p>
<pre>
perl flickr_getsets.pl
</pre>
<p>
Powodujemy pobranie i zapisanie informacji na temat wszystkich zbiorów
zdefiniowanych przez u¿ytkownika. Informacja ta jest zapisywana 
w katalogu <code>~/.flickr/nazwa.sets</code>.  Gdzie <code>~</code> jest
katalogiem domowym a nazwa to nazwa u¿ytkownika w serwisie flickr
(<em>screen name</em>).  
Podobnie skrypt <code>flickr_getalltags.pl</code> zapisuje
wszystkie zdefiniowane przez u¿ytkownika tagi w katalogu
<code>~/.flickr/nazwa.tags</code>.
</p>
<p>
Baza identyfikatorów geograficznych (geotagi) jest plikiem XML 
o nastêpuj±cym formacie:
</p>

<pre>
&lt;wpts>
&lt;wpt lat="54.37983" lon="18.28747">
  &lt;name>Przodkowo&lt;/name>
  &lt;identifier>Przodkowo#Skrzy¿owanie&lt;/identifier>
&lt;/wpt>
...
</pre>

<p>
Gdzie element <code>identifier</code> zawiera identyfikator miejsca,
a atrybuty <code>lat</code> i <code>lon</code> jego wspó³rzêdne
geograficzne. Baza ta znajduje siê w katalogu:
<code>~/.flickr/knows/where.flk</code>.
</p>

<p>Ponadto istnieje
skrypt <code>flickr_getphotolist.pl</code>, który pobiera i zapisuje
w pliku <code>~/.flickr/nazwa.ph</code> zestawienie wszystkich
zdjêæ u¿ytkownika 'nazwa', które maj± status 
publiczny (plik ten jest wykorzystywany, np. przez skrypt
<code>flickr_repTags.pl</code>, 
por. punkt <a href="#aux">skrypty pomocnicze</a>).
</p>

<h3 id='upld'>Jak za³adowaæ pliki na <code>www.flickr.com</code></h3>

<p>
Do tego s³u¿y skrypt <code>flickr_xload</code>, którego 
sposób uruchomienia jest nastêpuj±cy:
</p>
<pre>
flickr_xload --title tytu³ --description opis --set zbiory 
  --tag tagi --gt d³:szer:id:dok³ --rotate k±t plik
</pre>
<p>
Gdzie: <code>tytu³</code> to tytu³ rysunku; <code>opis</code> to opis
rysunku; <code>zbiory</code> to lista oddzielonych przecinkami
lokalnych identyfikatorów zbiorów; <code>tagi</code> to oddzielone
odstêpami tagi (tagi wielowyrazowe otocz cudzys³owem <code>"</code>);
<code>d³:szer:id:dok³</code> to odpowiednio: d³ugo¶æ i szeroko¶æ
geograficzna (zapisana w notacji dziesiêtnej), identyfikator
geograficzny oraz umowne oznaczenie dok³adno¶ci 
(por. <a href="http://www.flickr.com/services/api/flickr.photos.geo.setLocation.html">flickr.photos.geo.setLocation</a>); 
<code>k±t</code> spowoduje obrót rysunku o k±t
(dopuszczalne warto¶ci to 90, 180 lub 270) stopni w kierunku
przeciwnym do ruchu wskazówek zegara 
(por. <a href="http://www.flickr.com/services/api/flickr.photos.transform.rotate.html">flickr.photos.transform.rotate</a>);
<code>plik</code> to nazwa pliku. Przyk³ad:
</p>
<pre>
flickr_xload --set s8 --tag '"mushrooms" "mushroom picking" "Hypholoma"\
 geo:lon=18.536682 geo:lat=54.442495 geo:loc=Sopot#Ma³aGwiazda'\
 --gt '54.442495:18.536682:Sopot#Ma³aGwiazda:11' dscn3135.jpg
</pre>

<p>
Spowoduje dla pliku <code>dscn3135.jpg</code> z bie¿±cego katalogu: 1)
wys³anie go na <code>flickr.com</code> oraz 2) dodanie tagów
<em>mushrooms</em>, <em>mushroom picking</em> i <em>Hypholoma</em>;
3) dodanie stosownych dla <code>Sopot#Ma³aGwiazda</code> geotagów (pobranych
z bazy <code>~/.flickr/knows/where.flk</code>);
4) dodanie  identyfikatora zbioru(ów), tj. <code>s10</code> w tym przypadku.
</p>

<p>
Poniewa¿ pos³ugiwanie siê <code>flickr_xload</code> jest byæ do¶æ
skomplikowane i czasoch³onne, powsta³ skrypt <code>flickr_upld</code>, który
jest rodzajem preprocesora do <code>flickr_xload</code>. Mo¿na go uruchomiæ
z wieloma a nie jednym plikiem (wszystkie pliki bêd± mia³y ten sam opis)
oraz posiada du¿o prostsz± sk³adniê:
</p>

<pre>
flickr_upld [-title tytu³] [-keys tagi] [-geo id ] [-lrot|rrot] [-sets zbiory] [-file spec-plików]
</pre>
<p>
Gdzie: <code>tagi</code> to
oddzielone przecinkiem tagi (dla tagów wielowyrazowych zamiast odstêpu
u¿yj znaku <code>_</code>, tj. podkre¶lenie); <code>id</code> jest
identyfikatorem geograficznym,  <code>-lrot</code>
spowoduje obrót rysunku o 90, a <code>-rrot</code> o 270, stopni
w kierunku przeciwnym do ruchu wskazówek zegara; <code>spec-plików</code>
mo¿e zawieraæ znaki typu <code>*</code> czy <code>?</code>.
Argumenty <code>tytu³</code> oraz <code>zbiory</code> maj± takie samo znaczenie
jak w przypadku <code>flickr_xload</code>.
Przyk³adowo (opcje mo¿na zapisywaæ w postaci skróconej <code>-x</code>, 
gdzie <code>x</code> jest pierwsz± liter± nazwy opcji):
</p>

<pre>
flickr_upld -f *.jpg  -geo Sopot#Ma³aGwiazda -k mushrooms,mushroompicking,Hypholoma -s s8
</pre>

<p>Wypisze na standardowe wyj¶cie seriê poleceñ 
uruchomiaj±cych <code>flickr_xload</code>, np.:</p>

<pre>
#!/bin/bash
flickr_xload --set s8 --tag '"mushrooms" "mushroompicking" "Hypholoma" \
  geo:lon=18.536682 geo:lat=54.442495 geo:loc=Sopot#Ma³aGwiazda' \
  --gt '54.442495:18.536682:Sopot#MaÅ~BaGwiazda:11'  dscn3136.jpg
flickr_xload --set s8 --tag '"mushrooms" "mushroompicking" "Hypholoma" \
  geo:lon=18.536682 geo:lat=54.442495 geo:loc=Sopot#Ma³aGwiazda' \
  --gt '54.442495:18.536682:Sopot#MaÅ~BaGwiazda:11'  dscn3137.jpg
 ... itd ...
</pre>

<p>Uwaga: Skrypt flupload korzysta z bazy
 <code>~/.flickr/knows/where.flk</code>. 
</p>

<p>
Oczywi¶cie jest to skrajnie dziwaczne:-) ale zalecany sposób
postêpowanie to wykonanie <code>flickr_upld</code>, z przekierowaniem
na plik, a nastêpnie uruchomienie powsta³ego w ten sposób pliku, tj.:
</p>
<pre>
flickr_upld ... > 1.sh &amp;&amp; sh 1.sh 
</pre>


<h3>Tryb <code>My-flickr-upld</code> w Emacsie</h3>

<p>
<code>flickr_upld</code> usprawnia oznakowanie zdjêæ o tyle, ¿e mo¿na
nadaæ te same opisy zbiorom zdjêæ. W praktyce s± z tym jednak
problemy, zdjêcia z jednej sesji maj± czê¶æ tagów wspólne a czê¶æ nie.
Z konsoli jest ciê¿ko szybko dopisaæ co trzeba do odpowiednich
plików. ¯eby to robiæ sensowanie trzeba widzieæ ka¿de zdjêcie. Do
tego celu s³u¿y tryb <code>My-flickr-upld.el</code> dla Emacs. 
Pozwala oznakowaæ zdjêcia
w trybie interaktywnym. Por rysunek:
</p>

<p>
<!--
<img width="330" src="flickr-1.jpg" alt="[]"/>
 <img width="330" src="flickr-2.jpg" alt="[]"/>
-->
<a href="http://www.flickr.com/photos/tprzechlewski/297265224/" 
   title="Photo Sharing"><img 
    src="http://static.flickr.com/113/297265224_64806d39dc.jpg" 
    width="333"  alt="flickr-1" /></a>
 <a href="http://www.flickr.com/photos/tprzechlewski/297265332/" 
   title="Photo Sharing"><img 
    src="http://static.flickr.com/99/297265332_9fa3569514.jpg" 
    width="333"  alt="flickr-2" /></a>
</p>

<p>
W trybie <code>My-flickr-upld</code> ekran jest dzielony na pó³, w górnym oknie jest
wy¶wietlana lista plików (jeden wiersz = jeden plik). Tekst w tym oknie
mo¿na normalnie edytowaæ.  Obowi±zuje (b. uproszczona) sk³adnia skryptu
<code>flickr_upld</code>.
W dolnym oknie wy¶wietlany jest plik z wiersza,
w którym jest kursor.  Zdefiniowano ponadto kilka pomocnych skrótów
klawiszowych: <code>C-c C-c</code> -- kopiowanie opisu z poprzedniego
wiersza <code>C-c C-a</code> -- wstawienie nazwy zbioru 
<code>C-c C-g</code> -- wstawienie
identyfikatora geo <code>C-c C-t</code> albo 
<code>C-c C-k</code> -- wstawienie taga.
Polecenia wstawiaj±ce zbiory i tagi dzia³aj± w oparciu o bazy
<code>~/.flickr/nazwa.tags</code>,  
<code>~/.flickr/nazwa.sets</code>
oraz <code>~/.flickr/knows/where.flk</code> i dziêki temu pozwalaj±
na uzupe³nianie
nazw (<em>completion</em>, por. rys. poni¿ej).  Aby polecenia dzia³a³y prawid³owo
trzeba co jaki¶ czas od¶wie¿aæ bazy zbiorów/tagów u¿ywaj±c poleceñ:
 <code>flickr_getalltags.pl</code> i <code>flickr_getsets.pl</code>.
</p>

<p>
<!--
<img width="330" src="flickr-3.jpg" alt="[]"/>
 <img width="330" src="flickr-4.jpg" alt="[]"/>
-->
<a href="http://www.flickr.com/photos/tprzechlewski/297265421/" 
   title="Photo Sharing"><img src="http://static.flickr.com/118/297265421_14f12ef0fb.jpg" 
   width="333" alt="flickr-3" /></a>
 <a href="http://www.flickr.com/photos/tprzechlewski/297265533/" 
    title="Photo Sharing"><img src="http://static.flickr.com/109/297265533_c5748b504c.jpg" 
    width="333" alt="flickr-4" /></a>
</p>

<!-- dopisaæ info o wykorzystywanych pakietach @@ -->
<p>Reasumuj±c, sposób postêpowanie jest nastêpuj±cy:</p>

<ol>
<li>
W Emacsie wybierz z Menu &lt;My> albo <code>flickr-dir-init</code> albo 
<code>flickr-dir-edit</code>. Dodaj opisy obrazków; zapisz bufor.
Powstan± dwa pliki <code>flickr-list.dir</code>, który zawiera niezmodyfikowan±
zawarto¶æ bufora oraz <code>flickr-list.sh</code>.
</li>
<li>
Plik <code>flickr-list.sh</code> powsta³y w kroku (1) uruchom jak ka¿dy
inny skrypt pow³oki, tj.
<pre>sh flickr-list.sh > plik2.sh</pre>
</li>
<li>
Uruchom plik powsta³y w kroku (2), tj. <code>plik2.sh</code>: 
<pre>sh plik2.sh</pre>
</li>
</ol>

<h3 id='aux'>Skrypty pomocnicze</h3>
<p>
Skrypt <code>flickr_repTags.pl</code> s³u¿y do zamiany tagów na inne
tagi, tj: <em>s<sub>1</sub></em> => <em>n<sub>1</sub></em>, 
<em>s<sub>2</sub></em> => <em>n<sub>2</sub></em>, itd.
(gdzie <em>s<sub>i</sub></em> i <em>n<sub>i</sub></em> s± tagami).
Zbiory tagów <em>s<sub>i</sub></em>
oraz <em>n<sub>i</sub></em> s± zadeklarowane 
w odpowiednim pliku konfiguracyjnym (szczegó³y 
w opisie zawartym
w skrypcie). Przydatny do porz±dkowania tagów.
</p>

<h3>Pobierz</h3>

<p>Omawiane skrypty s± <a href="./scripts">tutaj</a></p>

<p>Puktem wyj¶cia w przypadku skryptów perlowych by³ modu³y
<a href="http://search.cpan.org/~cpb/Flickr-Upload/">Flickr-Upload-1.22</a>
i <a href="http://search.cpan.org/~iamcal/Flickr-API/">Flickr-API-0.08</a>.
Biblioteka <code>My-flickr-upld.el</code> wykorzystuje
z kolei <code>xml.el</code>, <code>image-file.el</code> oraz
fragmenty
i idee z <code>show-images.el</code> Normana
Walsha (jest czê¶ci± pakietu
<a href="http://sourceforge.net/projects/jpegrdf">jpegrdf</a>)
</p>

<h3>Do zrobienia</h3>

<p>
Du¿o, ale przy mojej (nie)znajomo¶ci (e)lispa w±tpliwe ¿ebym cokolwiek
istotnego by³ w stanie dodaæ.
</p>
<!-- ... ... -->

<p>
<a href="../../Proj.html#perl"><img
 longdesc="##back.png" src="/icons_/back.png" alt="Powrót"/>Powrót</a>
</p>

<hr/>

<address>
<a href="http://validator.w3.org/check/referer">
 <img longdesc="##valid-xhtml11.png" src="../../icons/valid-xhtml11.png"
          alt="Valid XHTML 1.1!" height="31" width="88"/></a>
(c) T.&nbsp;Przechlewski; 
ostatnia zmiana: "2010-06-16T07:55:52CEST"
</address>

</body>
</html>
<!--
Local variables:
 mode: xml
 sgml-always-quote-attributes:t
 sgml-indent-step:0
 sgml-indent-data:nil
 time-stamp-start:"\\(ostatnia zmiana\\|last modified\\):[ 	]+\\\\?[\"<]+"
 time-stamp-line-limit:0
 LocalWords: Przechlewski geotagowanie GPS tagi geotagi Emacs
 LocalWords: GPSLongitudeRef GPSLatitudeRef GPSLatitude GPSLongitude GPSAreaInformation
 ispell-local-dictionary: "polish"
End:
-->

