<?xml version='1.0' encoding='iso-8859-2'?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN"
   "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
 <head>

 <meta http-equiv="content-type" content="text/html; charset=iso-8859-2"/>
 <meta name="DC.creator" content="Tomasz Przechlewski" />
 <meta name='DC.date' content='2010-06-16T07:55:29CEST'/>
 <meta name='DC.rights' content='(c) Tomasz Przechlewski'/>

<!-- default styles: -->
<link rel="stylesheet" type="text/css" href="/style/tp-base.css" title='ES'/>
<link rel="alternate stylesheet" type="text/css" href="/style/tp-bw.css" title='NS'/>
<link rel="alternate stylesheet" type="text/css" href="/style/tp-big.css" title='BS'/>
<script type="text/javascript" src="/script/tp.js" ></script>
<!-- styles end  -->

<title>Obs³uga www.flickr.com</title>
</head>
<body xml:lang="pl">

<h2 class='main'>Dodawanie zdjêæ na <code>flickr.com</code> w trybie <code>My-flickr-upld</code>
<a class='flushright' href="./opis_new_en.html">
 <img longdesc="[[uk-f.gif" src="/icons_/uk-f.gif" alt="UK"/></a>
</h2>

<h3>Wprowadzenie</h3>

<p>Opisywanie zdjêæ na <code>flickr.com</code> jest czasoch³onne
je¿eli zdjêæ jest du¿o. Robienie tego <strong>po</strong> ich
umieszczeniu na stronie za pomoc± tzw. <em>niezwykle-wygodnego-interfejsu</em>
praktycznie nie wchodzi w grê. Poni¿ej opisa³em w jaki sposób dodajê
swoje zdjêcia na <code>flickr.com</code>. 
Sposób ten jest zapewne du¿o
mniej intuicyjny -- cokolwiek to oznacza -- ale niew±tpliwie du¿o
szybszy.
</p>

<h3>Pliki ,,konfiguracyjne''</h3>

<p>
Opis zdjêcia (tagi) maj± zawieraæ wspó³rzêdne geograficzne oraz nazwy
wa¿niejszych obiektów na zdjêciu (osoby, budowle itp...)  Zdjêcia s±
podzielone na zbiory (<em>set</em>), opis ma te¿ zawieraæ informacjê
do jakich zbiorów dodano zdjêcie oraz do jakich grup zdjêcie 
ma byæ wys³ane (<em>group pools</em>). 
<strong>Reasumuj±c opis zdjêcia to:
geotagi (wspó³rzêdne geograficzne oraz nazwa miejsca), 
tagi (pozosta³e), 
zbiory i pule grup (<em>group pools</em></strong>).
Tagi, zbiory i pule s± definiowane za pomoc± odpowiednich 
metod z API flickra.
</p>

<p>
Je¿eli chodzi o geotagi, to najpro¶ciej jest pobieraæ odpowiednie
warto¶ci z GPSa a nastêpnie dodawaæ geotagi w sposób opisany 
np. <a href="http://www.carto.net/projects/photoTools/gpsPhoto/">tutaj</a>.
(Por. te¿ mój krótki 
<a href="./geotagging-photos-with-gpsphoto.html">tekst</a> jak to zrobiæ)
Je¿eli zdjêcia zawieraj± geotagi, to sprawa jest z punktu
widzenie trybu <code>My-flickr-upld</code> za³atwiona.
</p>

<p>
Czasami jednak GPS zawiedzie albo go nie ma, wtedy mo¿na dodaæ wspó³rzêdne 
,,rêcznie''. Mo¿na to zrobiæ na dwa sposoby: 
poprzez wstawienie identyfikatora miejsca z bazy <em>lub</em>
poprzez dodanie wspó³rzêdnych w konwencji <code>#d³ugo¶æ:szeroko¶æ</code>.
Pierwszy z wy¿ej wymienionych sposobów korzysta
z bazy identyfikatorów typu <code>Sopot#Abrahama28</code>
czy <code>Gdañsk#Lotnisko</code>, którymi nale¿y siê pos³ugiwaæ podczas
opisywania zdjêæ.  
Baza identyfikatorów geograficznych (geotagi) jest plikiem XML 
o nastêpuj±cym formacie:
</p>

<pre>
&lt;wpts>
&lt;wpt lat="54.37983" lon="18.28747">
  &lt;name>Przodkowo&lt;/name>
  &lt;identifier>Przodkowo#Skrzy¿owanie&lt;/identifier>
&lt;/wpt>
...
</pre>

<p>
Gdzie element <code>identifier</code> zawiera identyfikator miejsca,
a atrybuty <code>lat</code> i <code>lon</code> jego wspó³rzêdne
geograficzne. Baza ta znajduje siê w pliku:
<code>~/.flickr/knows/where.flk</code>.
</p>

<p>Informacja o wspó³rzêdnych geograficznych jest
dodawana zarówno do pliku ze zdjêciem (w postaci odpowiednich tagów EXIF),
jak i do opisu zdjêcia na stronie flickra (za pomoc± specyficznych tagów 
rozpoczynaj±cych siê od <code>geo:</code>). Mówi±c bardziej konkretnie,
do opisu zdjêcia zostan± dodane nastêpuj±ce tagi: 
<code>geo:longitude=d³ugo¶æ</code>,
<code>geo:latitude=szeroko¶æ</code> oraz 
<code>geo:loc=nazwa</code>
(<code>geo:loc</code> tylko w wypadku pos³ugiwania siê
identyfikatorami miejsc; nazwa jest zawsze jednowyrazowa).  
Do pliku ze zdjêciem zostan± wstawione odpowiednie warto¶ci
nastêpuj±cych pól EXIF:
<code>GPSLongitudeRef</code>, 
<code>GPSLatitudeRef</code>, 
<code>GPSLatitude</code>, 
<code>GPSLongitude</code> oraz
<code>GPSAreaInformation</code> (to ostatnie tylko wtedy gdy pos³ugujemy
siê identyfikatorem miejsca.)
</p>

<p>
Dla pozosta³ych tagów stosujê konwencjê (od jakiego¶ czasu) wstawiania
pojêæ wielowyrazowych, a nie tworzenia jednowyrazowych dziwol±gów,
tj. <code>"tomasz przechlewski"</code> a nie
<code>tomaszprzechlewski</code> czy <code>tomasz_przechlewski</code>.
Aha, wszystkie tagi piszê ma³ymi literami. Baza tagów -- tak¿e 
w formacie XML -- znajduje siê w pliku
<code>~/.flickr/hr.icio.tags</code> i jest zak³adana/od¶wie¿ana za
pomoc± skryptu <code>flickr_getalltags.pl</code>, który ¶ci±ga wszystkie
do tej pory zdefiniowane przez mnie tagi z flickr.com.
</p>

<p>
Bazy zbiorów i puli znajduj± siê odpowiednio w plikach
<code>~/.flickr/hr.icio.sets</code> oraz 
<code>~/.flickr/hr.icio.groups</code>
i s± zak³adane/od¶wie¿ane za
pomoc± skryptów <code>flickr_getgroups.pl</code> 
oraz <code>flickr_getsets.pl</code> pobieraj±cych odpowiednie
informacje z flickr.com.
</p>

<p>
Bazy identyfikatorów miejsc, tagów, zbiorów i puli s± potrzebne
do szybkiego dodawania opisów do zdjêæ. 
Do od¶wie¿ania zawarto¶ci tych
plików od czasu do czasu 
uruchamiam skrypt <code>flickr_update_kb</code>:
</p>

<pre>
#!/bin/bash
echo "Refreshing information on tags/sets/geolocs/pools"

flickr_getsets &amp;&amp; flickr_getalltags &amp;&amp; flickr_getgroups &amp;&amp; \
flickr_xml2el > ~/.flickr/hr.icio.el 
</pre>

<p>Skrypt <code>flickr_xml2el.pl</code> zamienienia pliki
z informacjami o tagach, pulach, zbiorach i identyfikatorach miejsc
z formatu XML do postaci Emacs lisp.  Mo¿liwe jest wprawdzie -- za
pomoc± biblioteki <code>xml.el</code> bezpo¶rednie czytanie plików
<code>.xml</code> ale jest to przera¼liwie wolne i st±d pomys³ na
zewnêtrzne przetwarzanie Perlem.
</p>

<p><strong>Uwaga:</strong> skrypt <code>flickr_xml2el.pl</code> oraz
<code>flickr_xml2el</code> to ten sam skrypt (<code>flickr_xml2el</code> jest linkiem
do <code>flickr_xml2el.pl</code>). 
Podobnie jest w przypadku innych skryptów perlowych.
</p>

<h3 id='upld'>Umieszczanie zdjêæ na <code>www.flickr.com</code></h3>

<p>
Do tego s³u¿± skrypty <code>flickr_xload.pl</code> oraz
<code>flickr_upld.pl</code>. Przyk³adowe uruchomienie
skryptu <code>flickr_xload.pl</code> wygl±da nastêpuj±co:
</p>

<pre>
flickr_xload --title tytu³ --description opis --set zbiory 
  --tag tagi --gt d³:szer:id:dok³ --rotate k±t plik
</pre>
<p>
Gdzie: <code>tytu³</code> to tytu³ rysunku; <code>opis</code> to opis
rysunku; <code>zbiory</code> to lista oddzielonych przecinkami
lokalnych identyfikatorów zbiorów; <code>tagi</code> to oddzielone
odstêpami tagi (tagi wielowyrazowe otocz cudzys³owem <code>"</code>);
<code>d³:szer:id:dok³</code> to odpowiednio: d³ugo¶æ i szeroko¶æ
geograficzna (zapisana w notacji dziesiêtnej), identyfikator
geograficzny oraz umowne oznaczenie dok³adno¶ci 
(por. <a href="http://www.flickr.com/services/api/flickr.photos.geo.setLocation.html">flickr.photos.geo.setLocation</a>); 
<code>k±t</code> spowoduje obrót rysunku o k±t
(dopuszczalne warto¶ci to 90, 180 lub 270) stopni w kierunku
przeciwnym do ruchu wskazówek zegara 
(por. <a href="http://www.flickr.com/services/api/flickr.photos.transform.rotate.html">flickr.photos.transform.rotate</a>);
<code>plik</code> to nazwa pliku. Przyk³ad:
</p>
<pre>
flickr_xload --set s8 --tag '"mushrooms" "mushroom picking" "Hypholoma"\
 geo:lon=18.536682 geo:lat=54.442495 geo:loc=Sopot#Ma³aGwiazda'\
 --gt '54.442495:18.536682:Sopot#Ma³aGwiazda:11' dscn3135.jpg
</pre>

<p>
Spowoduje dla pliku <code>dscn3135.jpg</code> z bie¿±cego katalogu: 1)
wys³anie go na <code>flickr.com</code> oraz 2) dodanie tagów
<em>mushrooms</em>, <em>mushroom picking</em> i <em>Hypholoma</em>;
3) dodanie stosownych dla <code>Sopot#Ma³aGwiazda</code> geotagów (pobranych
z bazy <code>~/.flickr/knows/where.flk</code>);
4) dodanie  identyfikatora zbioru(ów), tj. <code>s10</code> w tym przypadku.
</p>

<p>
Poniewa¿ pos³ugiwanie siê <code>flickr_xload</code> jest nieporêczne
z uwagi na skomplikowan± postaæ argumentów wiersza poleceñ, powsta³
skrypt <code>flickr_upld</code>, który jest rodzajem preprocesora do
<code>flickr_xload</code>. Mo¿na go uruchomiæ z opcj± 
<code>--script plik</code>, gdzie <code>plik</code> zawiera nazwy
i opisy zdjêæ. Zak³ada siê, ¿e <code>plik</code> jest redagowany
w odpowiednim trybie edytora Emacs a <code>flickr_xload</code>
uruchamiany ,,z wnêtrza''Emacsa. Format pliku zawieraj±cego nazwy/opisy
zdjêæ jest nastêpuj±cy:
</p>

<pre>
dscf2001.jpg >> @g Sopot#Abrahama28 @k krzy¶,komputer,ja¶ @lrot 
dscf2003.jpg >> @g Sopot#Abrahama28 @k mushroom,flammulina_velutipes @s s1,s14 @p p1
</pre>

<p>Znaczenie prze³±czników <code>@g</code>, <code>@k</code>,
<code>@s</code>, <code>@p</code>, itp., powinno byæ oczywiste.
</p>

<p>Uwaga: je¿eli warto¶æ argumentu <code>@g</code> zaczyna siê od znaku
<code>#</code>, to skrypt oczekuje warto¶ci w postaci <code>#d³ugo¶æ:szeroko¶æ</code>.
W pozosta³ych wypadkach bêdzie traktowa³ argument jako identyfikator
miejsca i szuka³ go w bazie identyfikatorów. Brak <code>@g</code> lub
pusta warto¶æ tej opcji zak³ada, ¿e albo zdjêcie zawiera wspó³rzêdne
w odpowiednich polach EXIF albo nie ma byæ geotagowane.
</p>

<h3>Tryb <code>My-flickr-upld</code> w Emacsie</h3>

<p>Pos³uguj±c siê wierszem poleceñ albo prostym edytorem 
sprawne opisanie plików ze zdjêciami jest ciê¿kie. 
¯eby to robiæ sensownie trzeba
widzieæ ka¿de zdjêcie. Do tego celu s³u¿y tryb
<code>My-flickr-upld.el</code> dla Emacs.  Pozwala oznakowaæ zdjêcia
w trybie interaktywnym. Por. rysunek poni¿ej.
</p>

<p>Nale¿y rozpocz±æ od skopiowania zdjêæ do jakiego¶ katalogu.
Teraz uruchamiamy Emacsa 
a nastêpnie wykonujemy polecenie <code>My-flickr-images-init</code>. 
W odpowiedzi na wy¶wietlone w minibuforze zapytanie
o nazwê katalogu nale¿y podaæ ten, w którym s± skopiowane uprzednio zdjêcia.
Emacs stworzy bufor <code>flickr-list.dir</code> zawieraj±cy
zestawienie zdjêæ pokazane na rysunku poni¿ej. 
Pocz±tkowo ka¿dy wiersz zestawienia bêdzie zawiera³ tylko
nazwê pliki ze zdjêciem plus ,,puste'' prze³±czniki <code>@g</code>, <code>@k</code>.
Zawarto¶æ bufora  <code>flickr-list.dir</code> mo¿e byæ edytowana swobodnie.
Obowi±zuje w nim sk³adnia skryptu <code>flickr_upld</code>.
Dodatkowo zosta³o zdefiniowanych kilka u³atwieñ przy¶pieszaj±cych pracê.
</p>

<p>
<a href="http://www.flickr.com/photos/tprzechlewski/2102377721/" 
   title="Photo Sharing"><img 
    src="http://farm3.static.flickr.com/2353/2102377721_646ff76f80.jpg" 
    height="190"  alt="flickr-1" /></a>
 <a href="http://www.flickr.com/photos/tprzechlewski/2102377541/" 
   title="Photo Sharing"><img 
    src="http://farm3.static.flickr.com/2173/2102377541_15caaefb4c.jpg" 
    height="190"  alt="flickr-2" /></a>
 <a href="http://www.flickr.com/photos/tprzechlewski/2153620239/" 
   title="Photo Sharing"><img 
    src="http://farm3.static.flickr.com/2325/2153620239_d67d20d8f5.jpg" 
    height="190"  alt="flickr-2" /></a>
</p>

<p>
W trybie <code>My-flickr-upld</code> ekran jest dzielony na pó³, w górnym oknie jest
wy¶wietlana lista plików (jeden wiersz = jeden plik). 
W dolnym oknie wy¶wietlany jest plik z wiersza,
w którym jest kursor.  Zdefiniowano ponadto kilka pomocnych skrótów
klawiszowych: <code>C-c C-c</code> -- kopiowanie opisu z poprzedniego
wiersza <code>C-c C-a</code> -- wstawienie nazwy zbioru 
<code>C-c C-g</code> -- wstawienie
identyfikatora geo <code>C-c C-t</code> albo 
<code>C-c C-k</code> -- wstawienie taga.
Polecenia wstawiaj±ce zbiory i tagi dzia³aj± w oparciu o bazy
<code>~/.flickr/nazwa.tags</code>,  
<code>~/.flickr/nazwa.sets</code>
oraz <code>~/.flickr/knows/where.flk</code> i dziêki temu pozwalaj±
na uzupe³nianie
nazw (<em>completion</em>, por. rys. poni¿ej).  Aby polecenia dzia³a³y prawid³owo
trzeba co jaki¶ czas od¶wie¿aæ bazy zbiorów/tagów u¿ywaj±c poleceñ:
<code>flickr_getalltags.pl</code>,
<code>flickr_getgroups.pl</code> 
i <code>flickr_getsets.pl</code>.
</p>

<p>
Aby odró¿niæ zdjêcia zawieraj±ce zdefiniowane tagi EXIF ze wspó³rzêdnymi  
geograficznymi od tych, które tej informacji nie zawieraj±, generowana miniatura
zdjêcia zawiera czerwony prostok±t w lewym górnym rogu (je¿eli zdjêcie jest
ju¿ geotagowane).
</p>

<p>
<a href="http://www.flickr.com/photos/tprzechlewski/2103157676/" 
   title="Photo Sharing"><img 
   src="http://farm3.static.flickr.com/2073/2103157676_8512785ec5.jpg" 
   height="190" alt="flickr-3" /></a>
 <a href="http://www.flickr.com/photos/tprzechlewski/2103157844/" 
    title="Photo Sharing"><img 
    src="http://farm3.static.flickr.com/2113/2103157844_e4486f8fd4.jpg" 
    height="190" alt="flickr-4" /></a>
<a href="http://www.flickr.com/photos/tprzechlewski/2154414434/"
    title="Photo Sharing"><img 
    src="http://farm3.static.flickr.com/2048/2154414434_d72a4997c9.jpg" 
    height="190" alt="flickr-4" /></a>
</p>

<p>Po dodaniu opisów bufor nale¿y zapisaæ na dysk a nastêpnie
uruchomiæ polecenie <code>My-flickr-buffer-upload</code>, które
wy¶le zdjêcia na flickr.com. Mo¿na te¿ oczywi¶cie osi±gn±æ to samo
wpisuj±c w wierszu 
poleceñ, w katalogu w którym znajduj± siê zdjêcia: 
</p>

<pre>perl flickr_upld.pl -script flickr-list.dir
</pre>

<h3>Ró¿ne u¿yteczne informacje nt. flickr.com</h3>

<p>
Odsy³acze do zdjêæ na flickr.com s± tworzone wed³ug pewnego schematu.
Strona g³ówna zdjêcia ma adres <code>http://www.flickr.com/tprzechlewski/&lt;photo_id>/&lt;/photo_id></code>, gdzie
<code>&lt;photo_id></code> oznacza identyfikator zdjêcia. 
Plik ze zdjêciem ma za¶ nastêpuj±cy URL:
</p>

<pre>
http://static.flickr.com/&lt;server>/&lt;photo_id>_&lt;secret>_&lt;size>.jpg
</pre>

<p>
Warto¶ci <code>&lt;server></code> oraz <code>&lt;secret></code> mo¿na
ustaliæ np. poprzez wykonanie metody
<code>flickr.people.getPublicPhotos</code>.  Warto¶ciami size s±
<code>s</code> (square), <code>t</code> (thumbnail), <code>m</code>
(small), <code>b</code> (large), <code>o</code> (original).  Oznaczaj±
one odpowiednio pliki o wielko¶ciach 75, 100, 200, 1024 pikseli
i wielko¶æ oryginaln±. Rysunek typu <em>square</em> to kwadrat,
pozosta³e to prostok±ty o d³u¿szym boku równym podanej licznie
pikseli. Prostok±t o d³u¿szym boku równym 500 pikseli to wielko¶æ
zdjêcia, która jest wy¶wietlana na stronie g³ównej zdjêcia.  Ta
wielko¶æ jest wybierana je¿eli URL nie zawiera czê¶ci <code>_&lt;size></code>.
</p>

<p>Aby wy¶wietliæ stronê ze zdjêciem o podanym id nale¿y u¿yæ
adresu URL zgodnego z poni¿szym schematem:</p>

<pre>
http://flickr.com/photo.gne?id=&lt;photo_id&gt;
</pre>

<p>S± inne u¿yteczne adresy URL tego typu:</p>

<ul>
<li>pobierz informacje o zdjêciach u¿ytkownika w formacie RSS:
<code>http://www.flickr.com/services/feeds/photos_public.gne?id=&lt;user_NSID>&amp;format=rss_200</code>
</li>

<li>
jw. tylko pobierz zdjêcia z grupy o podanym NSID:
<code>http://www.flickr.com/groups_feed.gne?id=&lt;group_NSID>&amp;format=rss_200</code>
</li>

<li>
jw. tylko pobierz zdjêcia oznaczone okre¶lonym <em>tagiem</em>:
<code>http://www.flickr.com/services/feeds/photos_public.gne?tags=&lt;tag>&amp;format=rss_200</code>
</li>

<li>
wy¶lij list do u¿ytkownika (za pomoc± formularza):
<code>http://www.flickr.com/messages_write.gne?to=&lt;user_NSID></code>
</li>
</ul>

<h3>Pobierz</h3>

<p>Omawiane skrypty s± <a href="https://github.com/hrpunio/flickr_scripts">tutaj</a>.
Plik README zawiera wskazówki odno¶nie instalacji.
Opis wcze¶niejszej wersji skryptów oraz trybu <code>My-flickr-upld</code>
jest <a href='./opis.html'>tutaj</a>.</p>

<p>Punktem wyj¶cia w przypadku skryptów perlowych by³ modu³y 
<a href="http://search.cpan.org/~cpb/Flickr-Upload/">Flickr-Upload-1.22</a>
i <a href="http://search.cpan.org/~iamcal/Flickr-API/">Flickr-API-0.08</a>.
Biblioteka <code>My-flickr-upld.el</code> wykorzystuje
<code>image-file.el</code> oraz fragmenty i idee
z <code>show-images.el</code> Normana Walsha (jest czê¶ci± pakietu <a
href="http://sourceforge.net/projects/jpegrdf">jpegrdf</a>).
</p>

<!-- ;;; -->

<p>
<a href="../../Proj.html#perl"><img
 longdesc="[[back.png" src="/icons_/back.png" alt="Powrót"/>Powrót</a>
</p>

</body>
</html>
<!--
Local variables:
 mode: nxml
 time-stamp-start:"name='DC.date' content='"
 time-stamp-end:"'/>"
 time-stamp-line-limit:0
 LocalWords: Przechlewski geotagowanie GPS tagi geotagi Emacs preprocesora
 LocalWords: GPSLongitudeRef GPSLatitudeRef GPSLatitude GPSLongitude GPSAreaInformation
 ispell-local-dictionary: "polish"
End:
-->
